var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,l=(t,a,r)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[a]=r,n=(e,t)=>{for(var a in t||(t={}))i.call(t,a)&&l(e,a,t[a]);if(r)for(var a of r(t))o.call(t,a)&&l(e,a,t[a]);return e},s=(e,r)=>t(e,a(r)),d=(e,t,a)=>(l(e,"symbol"!=typeof t?t+"":t,a),a);import{g as c,m,h as u,a as h,c as p,S as g,l as f,d as b,F as w,j as y,e as C,w as x}from"./app.dd25191e.js";import{t as I}from"./index.2b57aca1.js";import{i as S}from"./index.5a8ec7a6.js";import{t as U}from"./index.14549756.js";import{i as M,r as A,q as k,s as v,E as O,n as z}from"./index.22509486.js";function P(e){let t;t=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):unescape(e.split(",")[1]);const a=e.split(",")[0].split(":")[1].split(";")[0],r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return new Blob([r.buffer],{type:a})}var j=M?(e=>{const t=/OS (\d)_.* like Mac OS X/g.exec(e),a=/Android (\d.*?);/g.exec(e)||/Android\/(\d.*?) /g.exec(e),r=null==t?void 0:t.pop(),i=null==a?void 0:a.pop();return{oldIOS:!!r&&+r<8.3,oldAndroid:!!i&&+i.substr(0,3)<4.5,ios:/\(i[^;]+;( U;)? CPU.+Mac OS X/.test(e),android:/Android/g.test(e),mQQBrowser:/MQQBrowser/g.test(e)}})(navigator.userAgent):{oldIOS:!1,oldAndroid:!1,ios:!1,android:!1,mQQBrowser:!1};function _(e){const t=function(e){e=e.replace(/^data:([^;]+);base64,/gim,"").replace(/\s/g,"");const t=atob(e),a=t.length,r=new ArrayBuffer(a),i=new Uint8Array(r);for(let o=0;o<a;o++)i[o]=t.charCodeAt(o);return r}(e),a=new DataView(t);if(65496!==a.getUint16(0,!1))return-2;const r=a.byteLength;let i=2;for(;i<r;){const e=a.getUint16(i,!1);if(i+=2,65505===e){if(1165519206!==a.getUint32(i+=2,!1))return-1;const e=18761===a.getUint16(i+=6,!1);i+=a.getUint32(i+4,e);const t=a.getUint16(i,e);i+=2;for(let r=0;r<t;r++)if(274===a.getUint16(i+12*r,e))return a.getUint16(i+12*r+8,e)}else{if(65280!=(65280&e))break;i+=a.getUint16(i,!1)}}return-1}function R(e,t,a,r,i){if(!M)return;const{width:o,height:l}=function(e,t,a,r){const i={width:e.width,height:e.height};if("5678".indexOf(t)>-1&&(i.width=e.height,i.height=e.width),i.width<a||i.height<r)return i;const o=+i.width/+i.height;return a&&r?o>=a/r?i.width>a&&(i.width=a,i.height=Math.ceil(a/o)):i.height>r&&(i.height=r,i.width=Math.ceil(r*o)):a?a<i.width&&(i.width=a,i.height=Math.ceil(a/o)):r<i.height&&(i.width=Math.ceil(r*o),i.height=r),(i.width>=3264||i.height>=2448)&&(i.width*=.8,i.height*=.8),i}(e,t,a,r),n=document.createElement("canvas"),s=n.getContext("2d");n.width=+o,n.height=+l,s.drawImage(e,0,0,o,l);let d=null;if(CSS&&CSS.supports&&!CSS.supports("image-orientation:none"))switch(t){case 3:s.rotate(180*Math.PI/180),s.drawImage(e,-o,-l,o,l);break;case 6:s.rotate(90*Math.PI/180),s.drawImage(e,0,-o,l,o);break;case 8:s.rotate(270*Math.PI/180),s.drawImage(e,-l,0,l,o);break;case 2:s.translate(o,0),s.scale(-1,1),s.drawImage(e,0,0,o,l);break;case 4:s.translate(o,0),s.scale(-1,1),s.rotate(180*Math.PI/180),s.drawImage(e,-o,-l,o,l);break;case 5:s.translate(o,0),s.scale(-1,1),s.rotate(90*Math.PI/180),s.drawImage(e,0,-o,l,o);break;case 7:s.translate(o,0),s.scale(-1,1),s.rotate(270*Math.PI/180),s.drawImage(e,-l,0,l,o);break;default:s.drawImage(e,0,0,o,l)}else"5678".includes(t)?s.drawImage(e,0,0,l,o):s.drawImage(e,0,0,o,l);if(j.oldIOS||j.oldAndroid||j.mQQBrowser||!navigator.userAgent){const e=s.getImageData(0,0,n.width,n.height);d=g.encode(e,100*i)}else d=n.toDataURL("image/jpeg",i);return d}var F=function(e,t=z){return new Promise(((a,r)=>{const{dataUrl:i,width:o,height:l,quality:n}=e,s=_(i),d=P(i);if(s>1||n<1||o||l){const e=new Image;e.src=i,e.onload=()=>{const r=R(e,s,o,l,n),i=P(r);t(r,i),a({dataUrl:r,blob:i})},e.onerror=()=>{t(null),r(new Error("image load error"))}}else t(i,d),a({dataUrl:i,blob:d})}))},B="the number of pictures exceeds the limit",E={name:{type:String,default:()=>A("image-reader")},disabled:{type:Boolean,deault:()=>!1},maxSize:{type:[String,Number],default:Number.MAX_VALUE},accept:{type:Array,default:()=>[]},isCameraOnly:{type:Boolean,default:!1},isMultiple:{type:Boolean,default:!1},maxAmount:{type:Number,default:Number.MAX_VALUE},beforeRead:{type:Function,default:void 0},isProcessor:{type:Boolean,default:()=>!1},processorOption:{type:Object,default:()=>({width:300,height:300,quality:.8})}},T=(e,{emit:t})=>{const a=m(Date.now()),r=()=>{a.value=Date.now()},i=u((()=>{if(e.accept.length){let t="";return e.accept.forEach((e=>{t+=`image/${e},`})),t.substring(0,t.length-1)}return"image/*"})),o=a=>{if(0===a.errorCode)if(e.isProcessor&&e.processorOption&&a.data){const{width:r,height:i,quality:o}=e.processorOption;F({dataUrl:a.data,width:r,height:i,quality:o}).then((({dataUrl:e})=>{t(v,{dataUrl:e,blob:P(e),file:a.file,errorMsg:"上传成功",errorCode:0})}))}else t(v,{dataUrl:a.data,blob:P(a.data),file:a.file,errorMsg:"上传成功",errorCode:0});else t(O,a)},l=t=>{const a={files:t,size:1e3*+e.maxSize,complete:o};new class{constructor(e){d(this,"files"),d(this,"index"),d(this,"size"),d(this,"complete");const{files:t,size:a}=e;this.files=t,this.index=0,this.size=a||0,this.complete=e.complete}readImage(){this.start(this.files)}start(e){e.map((e=>{this.readFileContent(e)}))}readFileContent(e){if(this.size&&e.size>this.size)return void this.complete({errorCode:101,errorMsg:`上传失败，您的图片超过最大值${this.size}kb`,file:e,data:null});const t=new FileReader;t.onload=()=>{this.complete({errorCode:0,errorMsg:"上传成功",file:e,data:t.result})},t.onerror=()=>{this.complete({errorCode:102,errorMsg:"上传失败",file:e,data:null})},t.readAsDataURL(e)}}(a).readImage()};return{inputTempKey:a,acceptType:i,onFileChange:a=>{const{files:i}=a.target;if(!i||!i.length||e.disabled)return;if(e.beforeRead){if(!e.beforeRead(i))return void r()}const o=[].slice.call(i);if(t(k,{files:o}),o&&e.maxAmount&&o.length>e.maxAmount)return t(O,{errorCode:"103",errorMsg:B,data:null}),void r();l(o)}}},D=c({name:"MdImageReader",props:E,emits:[k,v,O],setup(e,t){const{inputTempKey:a,acceptType:r,onFileChange:i}=T(e,t);return{inputTempKey:a,acceptType:r,onFileChange:i}}});D.render=function(e,t){return h(),p("div",{class:["md-image-reader",{disabled:e.disabled}]},[(h(),p("input",{key:e.inputTempKey,class:"md-image-reader-file",type:"file",name:e.name,maxSize:e.maxSize,maxAmount:e.maxAmount,disabled:e.disabled,accept:e.acceptType,capture:e.isCameraOnly,multiple:e.isMultiple,onChange:t[1]||(t[1]=(...t)=>e.onFileChange&&e.onFileChange(...t))},null,40,["name","maxSize","maxAmount","disabled","accept","capture","multiple"]))],2)};var q=D;q.install=e=>{e.component(q.name,q)};var Q=q;const L={class:"\n      md-example-child\n      md-example-child-reader\n      md-example-child-reader-0\n    "},N={class:"image-reader-list"},K={class:"image-reader-item add"},X=b("p",null,"添加图片",-1);var $=c(s(n({},{name:"ImageReaderDemo",title:"基本"}),{expose:[],setup(e){const t=f({reader0:["//img-hxy021.didistatic.com/static/strategymis/insurancePlatform_spu/uploads/27fb7f097ca218d743f816836bc7ea4a","//manhattan.didistatic.com/static/manhattan/insurancePlatform_spu/uploads/c2912793a222eb24b606a582fd849ab7"]}),a=e=>{e.files.forEach((e=>{console.log("[Mand Mobile] ImageReader Selected:","File Name "+e.name)})),U.loading("图片读取中...")},r=e=>{if(e.dataUrl){(t.reader0||[]).push(e.dataUrl)}U.hide()},i=e=>{U.failed(e.msg)};return(e,o)=>(h(),p("div",L,[b("ul",N,[(h(!0),p(w,null,y(C(t).reader0,((e,a)=>(h(),p("li",{key:a,class:"image-reader-item",style:{backgroundImage:`url(${e})`,backgroundPosition:"center center",backgroundRepeat:"no-repeat",backgroundSize:"cover"}},[b(C(I),{class:"image-reader-item-del",size:"small",shape:"quarter","fill-color":"#111A34",type:"fill","font-color":"#fff",onClick:e=>((e,a)=>{const r=t[e]||[];r.splice(a,1),t[e]=r})("reader0",a)},{default:x((()=>[b(C(S),{name:"close"})])),_:2},1032,["onClick"])],4)))),128)),b("li",K,[b(C(Q),{name:"reader0","is-multiple":"",onSelect:a,onComplete:r,onError:i}),b(C(S),{name:"camera",size:"md",color:"#CCC"}),X])])]))}})),V=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:$});const G={class:"\n      md-example-child\n      md-example-child-reader\n      md-example-child-reader-1\n    "},H={class:"image-reader-list"},J={class:"image-reader-item add"},W=b("p",null,"添加图片",-1);var Y=c(s(n({},{name:"ImageReaderDemo",title:"图片选择并轴向修正，压缩处理"}),{expose:[],setup(e){const t=f({reader0:[]}),a=()=>{U.loading("图片读取中...")},r=e=>{const a=t.reader0||[],r=e.dataUrl;F({dataUrl:r,width:200,height:200,quality:.1}).then((({dataUrl:e})=>{e&&a.push(e)})),U.hide()},i=e=>{U.failed(e.msg)};return(e,o)=>(h(),p("div",G,[b("ul",H,[(h(!0),p(w,null,y(C(t).reader0,((e,a)=>(h(),p("li",{key:a,class:"image-reader-item",style:{backgroundImage:`url(${e})`,backgroundPosition:"center center",backgroundRepeat:"no-repeat",backgroundSize:"cover"}},[b(C(I),{class:"image-reader-item-del",size:"small",shape:"quarter","fill-color":"#111A34",type:"fill","font-color":"#fff",onClick:e=>((e,a)=>{const r=t[e]||[];r.splice(a,1),t[e]=r})("reader0",a)},{default:x((()=>[b(C(S),{name:"close"})])),_:2},1032,["onClick"])],4)))),128)),b("li",J,[b(C(Q),{name:"reader1","is-multiple":"",onSelect:a,onComplete:r,onError:i}),b(C(S),{name:"camera",size:"md",color:"#CCC"}),W])])]))}})),Z=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:Y});export{V as _,Z as a};
