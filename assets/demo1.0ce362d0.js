var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,o=(t,a,r)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[a]=r,n=(e,t)=>{for(var a in t||(t={}))i.call(t,a)&&o(e,a,t[a]);if(r)for(var a of r(t))l.call(t,a)&&o(e,a,t[a]);return e},s=(e,r)=>t(e,a(r)),d=(e,t,a)=>(o(e,"symbol"!=typeof t?t+"":t,a),a);import{K as c,g as m,P as u,ak as h,al as p,am as g,s as f,h as b,a as w,c as y,an as C,E as x,m as I,d as S,F as U,j as M,e as k,n as A,k as v}from"./app.0cc1532a.js";import{t as O}from"./index.74738d46.js";import{t as z}from"./index.74ac7e59.js";function P(e){let t;t=e.split(",")[0].indexOf("base64")>=0?atob(e.split(",")[1]):unescape(e.split(",")[1]);const a=e.split(",")[0].split(":")[1].split(";")[0],r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return new Blob([r.buffer],{type:a})}var _=c?(e=>{const t=/OS (\d)_.* like Mac OS X/g.exec(e),a=/Android (\d.*?);/g.exec(e)||/Android\/(\d.*?) /g.exec(e),r=null==t?void 0:t.pop(),i=null==a?void 0:a.pop();return{oldIOS:!!r&&+r<8.3,oldAndroid:!!i&&+i.substr(0,3)<4.5,ios:/\(i[^;]+;( U;)? CPU.+Mac OS X/.test(e),android:/Android/g.test(e),mQQBrowser:/MQQBrowser/g.test(e)}})(navigator.userAgent):{oldIOS:!1,oldAndroid:!1,ios:!1,android:!1,mQQBrowser:!1};function j(e){const t=function(e){e=e.replace(/^data:([^;]+);base64,/gim,"").replace(/\s/g,"");const t=atob(e),a=t.length,r=new ArrayBuffer(a),i=new Uint8Array(r);for(let l=0;l<a;l++)i[l]=t.charCodeAt(l);return r}(e),a=new DataView(t);if(65496!==a.getUint16(0,!1))return-2;const r=a.byteLength;let i=2;for(;i<r;){const e=a.getUint16(i,!1);if(i+=2,65505===e){if(1165519206!==a.getUint32(i+=2,!1))return-1;const e=18761===a.getUint16(i+=6,!1);i+=a.getUint32(i+4,e);const t=a.getUint16(i,e);i+=2;for(let r=0;r<t;r++)if(274===a.getUint16(i+12*r,e))return a.getUint16(i+12*r+8,e)}else{if(65280!=(65280&e))break;i+=a.getUint16(i,!1)}}return-1}function R(e,t,a,r,i){if(!c)return;const{width:l,height:o}=function(e,t,a,r){const i={width:e.width,height:e.height};if("5678".indexOf(t)>-1&&(i.width=e.height,i.height=e.width),i.width<a||i.height<r)return i;const l=+i.width/+i.height;return a&&r?l>=a/r?i.width>a&&(i.width=a,i.height=Math.ceil(a/l)):i.height>r&&(i.height=r,i.width=Math.ceil(r*l)):a?a<i.width&&(i.width=a,i.height=Math.ceil(a/l)):r<i.height&&(i.width=Math.ceil(r*l),i.height=r),(i.width>=3264||i.height>=2448)&&(i.width*=.8,i.height*=.8),i}(e,t,a,r),n=document.createElement("canvas"),s=n.getContext("2d");n.width=+l,n.height=+o,s.drawImage(e,0,0,l,o);let d=null;if(CSS&&CSS.supports&&!CSS.supports("image-orientation:none"))switch(t){case 3:s.rotate(180*Math.PI/180),s.drawImage(e,-l,-o,l,o);break;case 6:s.rotate(90*Math.PI/180),s.drawImage(e,0,-l,o,l);break;case 8:s.rotate(270*Math.PI/180),s.drawImage(e,-o,0,o,l);break;case 2:s.translate(l,0),s.scale(-1,1),s.drawImage(e,0,0,l,o);break;case 4:s.translate(l,0),s.scale(-1,1),s.rotate(180*Math.PI/180),s.drawImage(e,-l,-o,l,o);break;case 5:s.translate(l,0),s.scale(-1,1),s.rotate(90*Math.PI/180),s.drawImage(e,0,-l,o,l);break;case 7:s.translate(l,0),s.scale(-1,1),s.rotate(270*Math.PI/180),s.drawImage(e,-o,0,o,l);break;default:s.drawImage(e,0,0,l,o)}else"5678".includes(t)?s.drawImage(e,0,0,o,l):s.drawImage(e,0,0,l,o);if(_.oldIOS||_.oldAndroid||_.mQQBrowser||!navigator.userAgent){const e=s.getImageData(0,0,n.width,n.height);d=C.encode(e,100*i)}else d=n.toDataURL("image/jpeg",i);return d}var F=function(e,t=x){return new Promise(((a,r)=>{const{dataUrl:i,width:l,height:o,quality:n}=e,s=j(i),d=P(i);if(s>1||n<1||l||o){const e=new Image;e.src=i,e.onload=()=>{const r=R(e,s,l,o,n),i=P(r);t(r,i),a({dataUrl:r,blob:i})},e.onerror=()=>{t(null),r(new Error("image load error"))}}else t(i,d),a({dataUrl:i,blob:d})}))},B="the number of pictures exceeds the limit",E={name:{type:String,default:()=>u("image-reader")},disabled:{type:Boolean,deault:()=>!1},maxSize:{type:[String,Number],default:Number.MAX_VALUE},accept:{type:Array,default:()=>[]},isCameraOnly:{type:Boolean,default:!1},isMultiple:{type:Boolean,default:!1},maxAmount:{type:Number,default:Number.MAX_VALUE},beforeRead:{type:Function,default:void 0},isProcessor:{type:Boolean,default:()=>!1},processorOption:{type:Object,default:()=>({width:300,height:300,quality:.8})}},T=(e,{emit:t})=>{const a=f(Date.now()),r=()=>{a.value=Date.now()},i=b((()=>{if(e.accept.length){let t="";return e.accept.forEach((e=>{t+=`image/${e},`})),t.substring(0,t.length-1)}return"image/*"})),l=a=>{if(0===a.errorCode)if(e.isProcessor&&e.processorOption&&a.data){const{width:r,height:i,quality:l}=e.processorOption;F({dataUrl:a.data,width:r,height:i,quality:l}).then((({dataUrl:e})=>{t(p,{dataUrl:e,blob:P(e),file:a.file,errorMsg:"上传成功",errorCode:0})}))}else t(p,{dataUrl:a.data,blob:P(a.data),file:a.file,errorMsg:"上传成功",errorCode:0});else t(g,a)},o=t=>{const a={files:t,size:1e3*+e.maxSize,complete:l};new class{constructor(e){d(this,"files"),d(this,"index"),d(this,"size"),d(this,"complete");const{files:t,size:a}=e;this.files=t,this.index=0,this.size=a||0,this.complete=e.complete}readImage(){this.start(this.files)}start(e){e.map((e=>{this.readFileContent(e)}))}readFileContent(e){if(this.size&&e.size>this.size)return void this.complete({errorCode:101,errorMsg:`上传失败，您的图片超过最大值${this.size}kb`,file:e,data:null});const t=new FileReader;t.onload=()=>{this.complete({errorCode:0,errorMsg:"上传成功",file:e,data:t.result})},t.onerror=()=>{this.complete({errorCode:102,errorMsg:"上传失败",file:e,data:null})},t.readAsDataURL(e)}}(a).readImage()};return{inputTempKey:a,acceptType:i,onFileChange:a=>{const{files:i}=a.target;if(!i||!i.length||e.disabled)return;if(e.beforeRead){if(!e.beforeRead(i))return void r()}const l=[].slice.call(i);if(t(h,{files:l}),l&&e.maxAmount&&l.length>e.maxAmount)return t(g,{errorCode:"103",errorMsg:B,data:null}),void r();o(l)}}},D=m({name:"MdImageReader",props:E,emits:[h,p,g],setup(e,t){const{inputTempKey:a,acceptType:r,onFileChange:i}=T(e,t);return{inputTempKey:a,acceptType:r,onFileChange:i}}});D.render=function(e,t){return w(),y("div",{class:["md-image-reader",{disabled:e.disabled}]},[(w(),y("input",{key:e.inputTempKey,class:"md-image-reader-file",type:"file",name:e.name,maxSize:e.maxSize,maxAmount:e.maxAmount,disabled:e.disabled,accept:e.acceptType,capture:e.isCameraOnly,multiple:e.isMultiple,onChange:t[1]||(t[1]=(...t)=>e.onFileChange&&e.onFileChange(...t))},null,40,["name","maxSize","maxAmount","disabled","accept","capture","multiple"]))],2)};var Q=D;Q.install=e=>{e.component(Q.name,Q)};var q=Q;const K={class:"\n      md-example-child\n      md-example-child-reader\n      md-example-child-reader-0\n    "},L={class:"image-reader-list"},N={class:"image-reader-item add"},X=S("p",null,"添加图片",-1);var $=m(s(n({},{name:"ImageReaderDemo",title:"基本"}),{expose:[],setup(e){const t=I({reader0:["//img-hxy021.didistatic.com/static/strategymis/insurancePlatform_spu/uploads/27fb7f097ca218d743f816836bc7ea4a","//manhattan.didistatic.com/static/manhattan/insurancePlatform_spu/uploads/c2912793a222eb24b606a582fd849ab7"]}),a=e=>{e.files.forEach((e=>{console.log("[Mand Mobile] ImageReader Selected:","File Name "+e.name)})),z.loading("图片读取中...")},r=e=>{if(e.dataUrl){(t.reader0||[]).push(e.dataUrl)}z.hide()},i=e=>{z.failed(e.msg)};return(e,l)=>(w(),y("div",K,[S("ul",L,[(w(!0),y(U,null,M(k(t).reader0,((e,a)=>(w(),y("li",{key:a,class:"image-reader-item",style:{backgroundImage:`url(${e})`,backgroundPosition:"center center",backgroundRepeat:"no-repeat",backgroundSize:"cover"}},[S(k(O),{class:"image-reader-item-del",size:"small",shape:"quarter","fill-color":"#111A34",type:"fill","font-color":"#fff",onClick:e=>((e,a)=>{const r=t[e]||[];r.splice(a,1),t[e]=r})("reader0",a)},{default:v((()=>[S(k(A),{name:"close"})])),_:2},1032,["onClick"])],4)))),128)),S("li",N,[S(k(q),{name:"reader0","is-multiple":"",onSelect:a,onComplete:r,onError:i}),S(k(A),{name:"camera",size:"md",color:"#CCC"}),X])])]))}})),V=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:$});const G={class:"\n      md-example-child\n      md-example-child-reader\n      md-example-child-reader-1\n    "},H={class:"image-reader-list"},J={class:"image-reader-item add"},W=S("p",null,"添加图片",-1);var Y=m(s(n({},{name:"ImageReaderDemo",title:"图片选择并轴向修正，压缩处理"}),{expose:[],setup(e){const t=I({reader0:[]}),a=()=>{z.loading("图片读取中...")},r=e=>{const a=t.reader0||[],r=e.dataUrl;F({dataUrl:r,width:200,height:200,quality:.1}).then((({dataUrl:e})=>{e&&a.push(e)})),z.hide()},i=e=>{z.failed(e.msg)};return(e,l)=>(w(),y("div",G,[S("ul",H,[(w(!0),y(U,null,M(k(t).reader0,((e,a)=>(w(),y("li",{key:a,class:"image-reader-item",style:{backgroundImage:`url(${e})`,backgroundPosition:"center center",backgroundRepeat:"no-repeat",backgroundSize:"cover"}},[S(k(O),{class:"image-reader-item-del",size:"small",shape:"quarter","fill-color":"#111A34",type:"fill","font-color":"#fff",onClick:e=>((e,a)=>{const r=t[e]||[];r.splice(a,1),t[e]=r})("reader0",a)},{default:v((()=>[S(k(A),{name:"close"})])),_:2},1032,["onClick"])],4)))),128)),S("li",J,[S(k(q),{name:"reader1","is-multiple":"",onSelect:a,onComplete:r,onError:i}),S(k(A),{name:"camera",size:"md",color:"#CCC"}),W])])]))}})),Z=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:Y});export{V as _,Z as a};
